# RA2YurisRevengeTrainer

红警2尤里的复仇内存修改器, 适用于 尤里的复仇 1.001

之前的 aa_engine 链接已失效，现在可以去看雪论坛下载 aa_engine 源码 https://bbs.kanxue.com/thread-187871.htm . 感谢原作者 axdx 的程序。目前 aa_engine 使用源码编译方式集成在该修改器中。

# 编译

使用 [CMake](https://cmake.org/), python3, npm, Ninja 和 Visual Studio 17 2022 构建。

## 编译后端

```
git clone https://github.com/AdjWang/RA2YurisRevengeTrainer.git
cd ./RA2YurisRevengeTrainer
cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_POLICY_DEFAULT_CMP0091=NEW -DCMAKE_MSVC_RUNTIME_LIBRARY=MultiThreaded -DCMAKE_INSTALL_PREFIX=deps/out/Release -G Ninja -S . -B ./build
cmake --build ./build --config Release --target ra2_trainer_backend -j $env:NUMBER_OF_PROCESSORS
```

## 编译前端

```
cd ./src/frontend/web
npm install
npm run build
cd ../../..
python scripts/generate_web_main_page.py
cmake --build ./build --config Release --target ra2_trainer -j $env:NUMBER_OF_PROCESSORS
```

# 功能简介

快捷键：Alt+功能括号后标记的按键

说明信息中涉及的功能用斜体表示。

## 输入框

1. 钱：顾名思义

## 按钮

1. 快速建造：提高建造速度
2. 删除单位：让**选中的**单位直接消失
3. 地图全开：地图迷雾全开(如果要看透裂缝产生器还需要开启 *瘫痪裂缝产生器* 功能)
4. 核弹攻击：获得一枚核弹
5. 单位升级：**选中的**单位升3级(可以对群体使用)
6. 单位加速：**选中的**单位移动速度增加(可以对群体使用)
7. 立即胜利：跳关用
8. 这是我的：**选中的**单位归到我方阵营
9. 成为幽灵玩家：**必须先选中一个我方建筑**，该功能会**销毁**该建筑。该建筑被销毁后名亡实存，就算玩家所有建筑和单位被消灭也不会输。系统会认定玩家还有建筑，但是该建筑没有实体无法再被AI消灭。

## 选项

1. 无敌：免疫任何伤害，但是不免疫工程师占领(免疫工程师占领的功能是 *全是我的-占领* )
2. 瞬间建造：顾名思义。
3. 无限超武：无限施放超级武器和伞兵之类，但是对上面的一次性 *核弹攻击* 功能无效。如果有发射井，*核弹攻击* 也是无效的。
4. 永久雷达：无视电力和是否有雷达建筑，都开启雷达。需要手动刷新(比如展开基地车)。
5. 极速攻击：攻击速度最大化。
6. 极速转身：战车和炮塔旋转速度最大化。(巨炮会变得很变态...)
7. 远程攻击：攻击距离最大化。(但是不警戒，不会自动远距离攻击)
8. 远程警戒：警戒距离最大化。( *远程攻击* 开启后使能。配合 *远程攻击* 使用，自动远距离攻击)
9. 瘫痪裂缝产生器：裂缝产生器无效化。
10. 瘫痪敌方所有单位：类似冻结效果。
11. 卖卖卖：可以售卖地图上所有单位，比如敌方建筑，任意中立建筑，步兵，战车等。
12. 无限电力：顾名思义。
13. 随意建筑：无视是否邻近、水面和陆地。
14. 自动修理：个人认为是最爽的功能。玩家占领的中立建筑也是可以修的~
15. 敌方血越修越少：敌方建筑修理时掉血。
16. 社会主义万岁：企图控制玩家单位的尤里(包括建筑和车)会归属给玩家。玩家的尤里阵亡后控制的单位不会回到敌方阵营。
17. 全是我的-攻击：企图攻击玩家的单位会归属给玩家。
18. 全是我的-占领：任何"占领"事件的目标单位归属给玩家。
19. 全是我的-房屋驻军：任何"房屋驻军"事件的目标单位归属给玩家，但是房子里的部队不会改变归属。
20. 侵略模式：开启后可以自动攻击敌方建筑物。
21. 全科技：开启全科技，开启后需要随便造个东西才能生效。
22. 极速重装-重新建造生效：单位重新装填速度最大化。(不是实时功能，仅对开启该功能后建造的单位生效)
23. 大量弹药-重新建造生效：单位弹药容量扩容到`20`。(不是实时功能，仅对开启该功能后建造的单位生效)
24. 瞬间超时空：超时空单位移动和攻击无冷却。配合 *极速攻击* 使用效果更佳。
25. 无间道：被敌方间谍入侵会获得敌方科技。
26. 滑板鞋：所有步兵高速滑行移动。
27. 部队全部三级：建筑也会升三级。
28. 任务调速：开启后执行任务时可以在暂停界面调整游戏速度。

# 注意事项

- 如果全局快捷键存在冲突，会注册失败，对应功能后的括号为空。
- 项目使用 `git submodule` 管理依赖，必须使用 `--recursive` 选项拉取仓库。
- 滑板鞋功能尚有问题，会导致步兵无法上桥，如果桥下是水面就会卡死在水里。
- 修改器退出时会在相同目录下产生 `dbglog.txt` 日志，默认记录最后 50 条以供故障排查。

# 闲话

做修改器只是产出逆向红警引擎的副产品，供单人游戏娱乐用，目标不是做出能在线上使用的外挂，请公平竞争。程序员要多研究网络，编程语言，操作系统和体系结构，少研究怎么搞钱。

## 新版改进

- 修复了句柄资源泄露的问题。
- 抛弃 MFC，改用 [GLFW](https://github.com/glfw/glfw) + [ImGui](https://github.com/ocornut/imgui)
- 添加快捷键，Alt+功能括号后标记的按键
- 改进任务调速功能实现方式。

## 下一步

- 考虑使用[bigsinger 提出的 DLL 注入方式](https://github.com/AdjWang/RA2YurisRevengeTrainer/issues/20)实现。以多一个 DLL 文件的代价换来如下好处：
    1. 使用局部快捷键，避免全局快捷键冲突。
    2. 在 DLL 里用 C++ 而不是汇编实现复杂功能更加容易。
    3. 现有 aa_engine 可在改造接口后在游戏进程内部使用，同样可以规避 msvc 内联汇编写法上的繁琐。
    4. 我一直怀疑远程线程，比如地图全开、核弹攻击，与引擎存在数据竞争是导致这些功能使游戏小概率崩溃的原因。改进方式是使用与游戏主循环串行执行的任务队列，在 DLL 中实现任务队列显然比跨进程消息传递和注入任务队列来得轻松许多。

- 添加功能记录和修改快捷键的配置文件
